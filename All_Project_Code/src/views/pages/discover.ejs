<!-- Include the 'head' partial for common head elements like CSS links, meta tags, etc. -->
<%- include ('../partials/head') %>

<!-- Include the 'menu' partial with 'pageType' set to 'discover' for the navigation menu -->
<%- include ('../partials/menu', { pageType: 'discover' }) %>

<div class="container mt-5">
  <!-- Search bar section -->
  <div class="row justify-content-center mb-4">
    <div class="col-md-6">
      <input type="text" class="form-control" placeholder="Search...">
    </div>
  </div>

  <div class="row no-gutters">
    <!-- Left sidebar for displaying categories -->
    <div class="col-md-2">
      <h5>Categories</h5>
      <ul class="list-unstyled">
        <li><a href="#">Assault Rifle</a></li>
        <li><a href="#">Submachine Gun</a></li>
        <li><a href="#">Knives</a></li>
        <li><a href="#">Secondaries</a></li>
      </ul>
    </div>

    <!-- Main content area -->
    <div class="col-md-8">
        <div class="row row-cols-auto">
            <% if (results && results.length > 0) { %>
                <% results.forEach(item => { %>
                    <div class="item">
                        <div class="card" style="width: 18rem;">
                            <img src="<%= item.itemimage %>" class="card-img-top" alt="Image of skin">
                            <div class="card-body">
                              <h5 class="card-title"><%= item.marketname %></h5>
                              <p class="card-text">Average Price in USD: $<%= item.priceavg %></p>
                            </div>
                            <ul class="list-group list-group-flush">
                              <li class="list-group-item">Type of Weapon: <%= item.itemtype %></li>
                              <li class="list-group-item">Item Name: <%= item.itemname %></li>
                              <li class="list-group-item">Rarity: <%= item.rarity %></li>
                            </ul>
                            <div class="card-body">
                              <a href="#" class="card-link">Card link</a>
                              <a href="#" class="card-link">Another link</a>
                            </div>
                          </div>
                    </div>
                <% }); %>
            <% } else { %>
                <p>No items found or there was an error.</p>
                <% if (error) { %>
                    <p>Error: <%= error %></p>
                <% } %>
            <% } %>
            </div>
        </div>

      <!-- Content to be inserted here -->


    <!-- Right sidebar for filters -->
    <div class="col-md-2">
      <h5>Filters</h5>
      <!-- Filter for selecting condition -->
      <div class="mb-3">
        <label for="conditionFilter" class="form-label">Condition</label>
        <select class="form-select" id="conditionFilter">
            <option value="fn" <% if (selectedWear === 'fn') { %>selected<% } %>>Factory New</option>
            <option value="mw" <% if (selectedWear === 'mw') { %>selected<% } %>>Minimal Wear</option>
            <option value="ft" <% if (selectedWear === 'ft') { %>selected<% } %>>Field Tested</option>
            <option value="ww" <% if (selectedWear === 'ww') { %>selected<% } %>>Well Worn</option>
            <option value="bs" <% if (selectedWear === 'bs') { %>selected<% } %>>Battle Scarred</option>
        </select>
      </div>
      <script>
        document.getElementById('conditionFilter').addEventListener('change', function() {
          var selectedCondition = this.value;
          var selectedSortOrder = document.getElementById('priceSort').value;
          window.location.href = `/discover?wear=${encodeURIComponent(selectedCondition)}&sort=${encodeURIComponent(selectedSortOrder)}`;
          
        });
      </script>
      <!-- Filter for sorting by price -->
      <div class="mb-3">
        <label for="priceSort" class="form-label">Sort by Price</label>
        <select class="form-select" id="priceSort">
            <option value="High to Low" <% if (selectedSort === 'High to Low') { %>selected<% } %>>High to Low</option>
            <option value="Low to High" <% if (selectedSort === 'Low to High') { %>selected<% } %>>Low to High</option>
        </select>    
      </div>
      <script>
        document.getElementById('priceSort').addEventListener('change', function() {
            var selectedSortOrder = this.value;
            var selectedCondition = document.getElementById('conditionFilter').value;
            window.location.href = `/discover?sort=${encodeURIComponent(selectedSortOrder)}&wear=${encodeURIComponent(selectedCondition)}`;
        });
        </script>
    </div>
  </div>
</div>

<!-- Include the 'footer' partial for the page footer -->
<%- include ('../partials/footer') %>
